clc; clear; format long G
ref1=[0.52;0.64;0.71];
D=[24;20;16];
h1=[2.15,2.15,2.15,2.15,2.15;
    1.78,1.78,1.78,1.78,1.78;
1.44,1.44,1.44,1.44,1.44];

ref2=[0.09;0.64;0.71];
h2=[0.68,0.68,0.68,0.68,0.68;
    1.05,1.05,1.05,1.05,1.05;
    0.98,0.98,0.98,0.98,0.98];

[r,s]=size(h1);
R1=ones(r,s);
R2=ones(r,s);
for n=1:r
    for m=1:s
        R1(n,m)=((D(n,1)/2)^2+(h1(n,m)-ref1(n,1))^2)/(2*(h1(n,m)-ref1(n,1)));
        R2(n,m)=((D(n,1)/2)^2+(h2(n,m)-ref2(n,1))^2)/(2*(h2(n,m)-ref2(n,1)));
    end
    Ua1(n)=std(R1(n,:));
    Ub1(n)=0.01/sqrt(12);
    Uc1(n)=sqrt((Ua1(n)^2+Ub1(n)^2)/s);
    Ucp1(n)=sqrt(((((D(n)/2)^2)/(4*mean(h1(n,:))-4*ref1(n)))*Uc1(n)^2)+(((32*mean(h1(n,:))^2-64*mean(h1(n,:))*ref1(n)+32*ref1(n)^2-8*D(n)^2)/(8*mean(h1(n,:))-8*ref1(n))^2)*Uc1(n)^2)+(((-32*mean(h1(n,:))^2+64*mean(h1(n,:))*ref1(n)-32*ref1(n)^2+8*D(n)^2)/(8*mean(h1(n,:))-8*ref1(n))^2)*Uc1(n)^2))*1.96;
    Ua2(n)=std(R2(n,:));
    Ub2(n)=0.01/sqrt(12);
    Uc2(n)=sqrt((Ua2(n)^2+Ub2(n)^2)/s);
    Ucp2(n)=sqrt(((((D(n)/2)^2)/(4*mean(h2(n,:))-4*ref2(n)))*Uc2(n)^2)+(((32*mean(h2(n,:))^2-64*mean(h2(n,:))*ref2(n)+32*ref2(n)^2-8*D(n)^2)/(8*mean(h2(n,:))-8*ref2(n))^2)*Uc2(n)^2)+(((-32*mean(h2(n,:))^2+64*mean(h2(n,:))*ref2(n)-32*ref2(n)^2+8*D(n)^2)/(8*mean(h2(n,:))-8*ref2(n))^2)*Uc2(n)^2))*1.96;
end
R1=mean(mean(R1'));
R2=-mean(mean(R2'));
nej_sfe1=sqrt((1/3)^2*Ucp1(1,1)^2+(1/3)^2*Ucp1(1,2)^2+(1/3)^2*Ucp1(1,3)^2)*1.96;
nej_sfe2=sqrt((1/3)^2*Ucp2(1,1)^2+(1/3)^2*Ucp2(1,2)^2+(1/3)^2*Ucp2(1,3)^2)*1.96;

t=1.847;
t_nej=0.12;
n2=1.51564;n1=1;
f=(n2*R1*R2)/(n2^2*R2-n2^2*R1-n2*R2+n2*R1+n2^2*t-2*n2*t+t);
Cr1=((n2^3*R2^2-n2^2*R2^2+n2^3*t*R2-2*n2^2*t*R2+n2*t*R2)/((n2^2*R2-n2^2*R1-n2*R2+n2*R1+n2^2*t-2*n2*t+t)^2))^2*nej_sfe1^2;
Cr2=((-n2^3*R1^2+n2^2*R1^2+n2^3*t*R1-2*n2^2*t*R1+n2*t*R1)/((n2^2*R2-n2^2*R1-n2*R2+n2*R1+n2^2*t-2*n2*t+t)^2))^2*nej_sfe2^2;
Cr3=((-(n2^3*R1*R2-2*n2^2*R1*R2+n2*R1*R2)/((n2^2*R2-n2^2*R1-n2*R2+n2*R1+n2^2*t-2*n2*t+t)^2)))^2*t_nej^2;
nej_f=sqrt(Cr1+Cr2+Cr3)*1.96;
